{% extends dashboard_base_template %}
{% load static %}
{% load edc_visit_schedule_extras %}
{% load edc_subject_dashboard_extras %}

{% block main %}

<div id="subject_dashboard" class="container">
  <div class="row">
  <div class="col-md-9">
  
    <div class="panel-group" id="accordion_schedule">

        {% if not visit_schedules %}
          <div class="alert alert-warning">
              <i class="far fa-hand-paper fa-lg fa-fw"></i> Subject is not enrolled to any schedules.
          </div>
          <div class="panel panel-default">
              <div class="panel-heading">
                  <h6 class="panel-title"><i class="far fa-calendar fa-lg fa-fw"></i> 
                      <a href="#">Schedules</a>
                  </h6>
              </div>
          </div>
        {% endif %}

        {% if appointment %}
			<div id="subject_dashboard_for_{{ current_visit_schedule.name|slugify }}-{{ current_schedule.name|slugify }}"
				class="panel panel-{% if anonymous %}danger{% else %}info{% endif %}">
			<div class="panel-heading clearfix">
			  <i class="far fa-calendar fa-lg fa-fw"></i> 
			      <a data-toggle="collapse" data-parent="#accordion_{{ current_visit_schedule.name|slugify }}-{{ appointment.schedule_name|slugify }}" aria-hidden="true"
			         href="#subject_dashboard_forms_for_{{ current_visit_schedule.name|slugify }}-{{ current_schedule.name|slugify }}">
			         {{ current_visit_schedule.verbose_name }} <i class="fa fa-caret-right"></i> {{ current_schedule.verbose_name }} <i class="fa fa-caret-right"></i> {{ appointment.visit_code }}.{{ appointment.visit_code_sequence }} {{ appointment.title|lower|title }} <span class="caret"></span>
			      </a>
	            {% block schedule_button %}
	            <span class="pull-right"><span class="text test-muted">
	                <a href="{% url subject_dashboard_url subject_identifier=subject_identifier %}"
	                   role="button" class="btn btn-sm btn-primary">
	                    <i class="fa fa-reply fa-fw" aria-hidden="true"></i> <i class="far fa-calendar fa-fw"></i> Schedule
	                </a>
	            </span></span>
	            {% endblock schedule_button %}
			</div>
			<div id="subject_dashboard_forms_for_{{ current_visit_schedule.name|slugify }}-{{ current_schedule.name|slugify }}"
				class="panel-collapse collapse in">
				    {% block crfs %}
				  		{% include "edc_subject_dashboard/dashboard/crfs.html" %}
				    {% endblock crfs %}

					{% block requisitions %}
					  	{% include "edc_subject_dashboard/dashboard/requisitions.html" %}
					{% endblock requisitions %}
			</div>
				{% block dashboard_schedule_footer %}
				
					{% subject_schedule_footer_row subject_identifier current_visit_schedule current_schedule subject_dashboard_url %}
				{% endblock dashboard_schedule_footer %}	
	     	</div>
        {% else %}
           {% block visit_schedules_panel %}
		      {% for visit_schedule in visit_schedules.values %}
        		 {% include "edc_subject_dashboard/dashboard/schedules.html" %}
        	  {% endfor %}
		   {% endblock visit_schedules_panel %}
	    {% endif %}
    </div> <!-- panel-group -->
  
 </div> <!-- col-md-9 -->

  <div class="col-md-3">

	{% block top_bar %}

	    {% include "edc_subject_dashboard/dashboard/topbar.html" %}
	
	{% endblock top_bar %}

    {% block side_bar %}

	    {% include 'edc_subject_dashboard/dashboard/sidebar.html' %}

    {% endblock side_bar %}

</div> <!-- col-md-3 -->
</div> <!-- row -->
</div> <!-- container -->
{% endblock main %}